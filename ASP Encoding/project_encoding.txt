% CSE 620 Final Project - Day Trading Profit Capitalization
% Author: Matthew O'Connor
% KRR Methodology: Temporal Projection

% The current hour
#const hour=8.
% The current minute
#const minute=0.

% Agent's budget'
#const budget=3627300.
% The stoploss is -2.5 percent
#const stoploss=-250.
% The day profit_marker is 5 percent
#const day_profit_marker=500.
% The post profit_marker is 2.5 percent
#const post_profit_marker=250.
% The AM Buy Marker is -0.05 percent (will be from 930 - 12 if i make others)
#const buy_marker=-5.
% A backup marker incase the agent has not purchased a stock and market hours have closed
#const backup_buy_marker=5.
% Agent can buy company X at askprice Y if the day percentage move is less than the AM buy marker and we are during market hours
can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P < buy_marker, not bought(X), hour >= 9.
can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P < buy_marker, not bought(X), hour >= 1, hour < 4.
% Agent can buy company X at askprice Y if the post percentage move is less than the buy marker and we are after hours
can_buy(X, Y)  :- company(X), askprice(Y, X), percentagemovepost(P, X), P < buy_marker, hour >= 5, hour < 8, not bought(X).
can_buy(X, Y)  :- company(X), askprice(Y, X), percentagemovepost(P, X), P < buy_marker, hour = 4, minute > 10, not bought(X).
% Agent can buy company X at askprice Y if the time is between 5:45 and 5:55 and the company has not been purchased - this is intended to be a force buy
force_buy(X, Y)  :- company(X), askprice(Y, X), hour = 5, minute >= 45, minute <= 55, not bought(X).
% Rule 11: Agent will can company X if its percentage move after hours is between the buy marker and the backup buy marker and time is between 4:01 - 4:10
can_buy(X, Y) :- company(X), askprice(Y, X), not bought(X), percentagemovepost(P, X), P >= buy_marker, P <= backup_buy_marker, hour = 4, minute <= 10, minute >= 1.
% Agent cannot buy company X at askprice Y if the day percentage move is greater than 0 and we are during market hours
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P > 0, hour >= 9, not bought(X).
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P > 0, hour >= 1, hour < 4, not bought(X).
% Agent cannot buy company X at askprice Y if the post percentage move is greater than 0 and we are after hours
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemovepost(P, X), P > 0, hour >= 5, hour < 8, not bought(X).
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemovepost(P, X), P > 0, hour = 4, minute > 10, not bought(X).
% Agent cannot buy company X at askprice Y if the day percentage move is less than 0 but greater than the AM buy marker and we are during market hours
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P <= 0, P > buy_marker, hour >= 9, not bought(X).
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemoveday(P, X), P <= 0, P > buy_marker, hour >= 1, hour < 4, not bought(X).
% Agent cannot buy company X at askprice Y if the post percentage move is less than 0 but greater than the buy marker and we are after hours
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemovepost(P, X), P <= 0, P > buy_marker, hour >= 5, hour < 8, not bought(X).
-can_buy(X, Y) :- company(X), askprice(Y, X), percentagemovepost(P, X), P <= 0, P > buy_marker, hour = 4, minute > 10, not bought(X).
% Agent cannot buy company X at askprice Y if X has been purchased
-can_buy(X, Y) :- bought(X), askprice(Y, X).
% Agent either buys or doesn't buy company X at askprice Y if can_buy(X, Y)
buy(X, Y) | -buy(X, Y) :- can_buy(X, Y).
% Agent cannot buy company X at askprice Y if -can_buy(X, Y)
-buy(X, Y) :- -can_buy(X, Y).
% Agent can sell company X at bidprice Y if the position move total is less than the stoploss
can_sell(X, Y) :- company(X), bidprice(Y, X), bought(X), positionmovetotal(P, X), P <= stoploss.
% Agent can sell company X at bidprice Y if the position move post is less than the stoploss and we are after hours
can_sell(X, Y) :- company(X), bidprice(Y, X), bought(X), positionmovepost(P, X), P <= stoploss, hour >= 4, hour < 8.
% Agent cannot sell company X at bidprice Y if the position move total is greater than the stoploss
-can_sell(X, Y) :- company(X), bidprice(Y, X), bought(X), positionmovetotal(P, X), P > stoploss.
% Agent cannot sell company X at bidprice Y if the position move post is greater than the stoploss and we are after hours
-can_sell(X, Y) :- company(X), bidprice(Y, X), bought(X), positionmovepost(P, X), P > stoploss, hour >= 4, hour < 8.
% Agent either sells or does not sell company X at bidprice Y
sell(X, Y) | -sell(X, Y) :- can_sell(X, Y).
% Agent cannot sell company X at bidprice Y if -can_sell(X, Y)
-sell(X, Y) :- -can_sell(X, Y).
% Agent cannot monitor company X if agent is buying company X at price Y
-can_monitor(X) :- buy(X, Y), price(Y).
% Agent cannot monitor company X if agent is selling company X at price Y
-can_monitor(X) :- sell(X, Y), price(Y).
% Agent can monitor company X as long as it is unknow that they cannot monitor X
can_monitor(X) :- company(X), not -can_monitor(X).
% Agent monitors company X if can_monitor(X)
monitor(X) :- can_monitor(X).
% Agent cannot monitor company X if -can_monitor(X)
-monitor(X) :- -can_monitor(X).
% Agent wil monitor a company X if it has been bought and sold
monitor(X) :- bought(X), sold(X).% X is a price, either ask or bid
price(Y) :- askprice(Y, X).
price(Y) :- bidprice(Y, X).
%%%%%%%%%%%%%%%%%%%% RULES %%%%%%%%%%%%%%%%%%%%
% Rule 1: Agent will close all open positions at the end of trading hours, 8PM
sell_all(X, Y) :- not sold(X), bought(X), company(X), bidprice(Y, X), hour = 7, minute = 59.
% Rule 2: Agent cannot buy the same stock more than 1 time that day
-can_buy(X, Y) :- bought(X), price(Y).
% Rule 3: Agent cannot buy two different stocks at the same time
:- buy(X, Y), buy(X2, Y2), company(X), price(Y), company(X2), price(Y2), X != X2.
% Rule 4: Agent cannot buy a stock while selling a different stock
-buy(X, Y) :- sell(X2, Y2), X != X2, price(Y), company(X).
% Rule 5: It is impossible to sell a stock Agent do not own
-can_sell(X, Y) :- not bought(X), price(Y), company(X).
% Rule 6: Agent cannot sell two different stocks at the same time
-sell(X, Y) :- sell(X2, Y2), X != X2, company(X), price(Y).
% Rule 7: Agent cannot sell a stock while buying a different stock
-sell(X, Y) :- buy(X2, Y2), X != X2, price(Y), company(X).
% Rule 8: Agent cannot sell the same stock more than 1 time that day
-can_sell(X, Y) :- sold(X), price(Y).
% Rule 9: Agent can sell after hours if a post position move above the post profit marker is observed.
can_sell(X, Y) :- not sold(X), percentagemovepost(P, X), P >= post_profit_marker, price(Y), company(X), hour >= 4, hour < 8.
% Rule 10: Agent can sell during the day if a day position move above the day profit marker is observed.
can_sell(X, Y) :- not sold(X), percentagemoveday(P, X), P >= day_profit_marker, price(Y), company(X), bought(X), hour >= 9.
can_sell(X, Y) :- not sold(X), percentagemoveday(P, X), P >= day_profit_marker, price(Y), company(X), bought(X), hour >= 1, hour < 4.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% INFORMATION FOR TSLA %%%
company(tsla).
% The bid price for TSLA
bidprice(40535, tsla).
% The ask price for TSLA
askprice(40542, tsla).
% The bid size for TSLA
bidsize(14000000, tsla).
% The ask size for TSLA
asksize(400000, tsla).
% The high price for TSLA
highprice(41168, tsla).
% The low price for TSLA
lowprice(38278, tsla).
% The close price for TSLA
closeprice(40416, tsla).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR CART %%%
company(cart).
% The bid price for CART
bidprice(4026, cart).
% The ask price for CART
askprice(4120, cart).
% The bid size for CART
bidsize(25000000, cart).
% The ask size for CART
asksize(10000000, cart).
% The high price for CART
highprice(4171, cart).
% The low price for CART
lowprice(3954, cart).
% The close price for CART
closeprice(4103, cart).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR COIN %%%
company(coin).
% The bid price for COIN
bidprice(28450, coin).
% The ask price for COIN
askprice(28500, coin).
% The bid size for COIN
bidsize(14800000, coin).
% The ask size for COIN
asksize(400000, coin).
% The high price for COIN
highprice(29257, coin).
% The low price for COIN
lowprice(26816, coin).
% The close price for COIN
closeprice(28405, coin).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR GBX %%%
company(gbx).
% The bid price for GBX
bidprice(4207, gbx).
% The ask price for GBX
askprice(4374, gbx).
% The bid size for GBX
bidsize(2000000, gbx).
% The ask size for GBX
asksize(1000000, gbx).
% The high price for GBX
highprice(4131, gbx).
% The low price for GBX
lowprice(4141, gbx).
% The close price for GBX
closeprice(4291, gbx).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR DASH %%%
company(dash).
% The bid price for DASH
bidprice(20750, dash).
% The ask price for DASH
askprice(20800, dash).
% The bid size for DASH
bidsize(800000, dash).
% The ask size for DASH
asksize(2800000, dash).
% The high price for DASH
highprice(20907, dash).
% The low price for DASH
lowprice(19290, dash).
% The close price for DASH
closeprice(20701, dash).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR SNAP %%%
company(snap).
% The bid price for SNAP
bidprice(856, snap).
% The ask price for SNAP
askprice(860, snap).
% The bid size for SNAP
bidsize(2000000, snap).
% The ask size for SNAP
asksize(1000000, snap).
% The high price for SNAP
highprice(860, snap).
% The low price for SNAP
lowprice(831, snap).
% The close price for SNAP
closeprice(854, snap).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR APP %%%
company(app).
% The bid price for APP
bidprice(55779, app).
% The ask price for APP
askprice(55900, app).
% The bid size for APP
bidsize(2400000, app).
% The ask size for APP
asksize(3600000, app).
% The high price for APP
highprice(57027, app).
% The low price for APP
lowprice(52900, app).
% The close price for APP
closeprice(55769, app).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR IONQ %%%
company(ionq).
% The bid price for IONQ
bidprice(4808, ionq).
% The ask price for IONQ
askprice(4825, ionq).
% The bid size for IONQ
bidsize(2000000, ionq).
% The ask size for IONQ
asksize(1000000, ionq).
% The high price for IONQ
highprice(4851, ionq).
% The low price for IONQ
lowprice(4282, ionq).
% The close price for IONQ
closeprice(4716, ionq).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR TOST %%%
company(tost).
% The bid price for TOST
bidprice(3601, tost).
% The ask price for TOST
askprice(3606, tost).
% The bid size for TOST
bidsize(10000000, tost).
% The ask size for TOST
asksize(5000000, tost).
% The high price for TOST
highprice(3738, tost).
% The low price for TOST
lowprice(3582, tost).
% The close price for TOST
closeprice(3581, tost).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR HIMS %%%
company(hims).
% The bid price for HIMS
bidprice(3740, hims).
% The ask price for HIMS
askprice(3749, hims).
% The bid size for HIMS
bidsize(1000000, hims).
% The ask size for HIMS
asksize(11000000, hims).
% The high price for HIMS
highprice(3799, hims).
% The low price for HIMS
lowprice(3493, hims).
% The close price for HIMS
closeprice(3702, hims).
%%%%%%%%%%%%%%%%%%%%%%%%
%%% INFORMATION FOR CMG %%%
company(cmg).
% The bid price for CMG
bidprice(3167, cmg).
% The ask price for CMG
askprice(3162, cmg).
% The bid size for CMG
bidsize(1000000, cmg).
% The ask size for CMG
asksize(1000000, cmg).
% The high price for CMG
highprice(3146, cmg).
% The low price for CMG
lowprice(3101, cmg).
% The close price for CMG
closeprice(3157, cmg).
%%%%%%%%%%%%%%%%%%%%%%%%

bought(coin).
bought(dash).
bought(tost).
bought(tsla).
bought(cmg).
bought(gbx).
bought(ionq).
bought(hims).
bought(cart).
bought(app).
bought(snap).

sold(dash).
sold(coin).
sold(tsla).
sold(tost).
sold(cart).
sold(gbx).
sold(snap).
sold(app).
sold(ionq).
sold(hims).
sold(cmg).

% The agent's position status of TSLA
positionmovetotal(0, tsla).
positionmovepost(0, tsla).
% The agent's position status of CART
positionmovetotal(0, cart).
positionmovepost(0, cart).
% The agent's position status of COIN
positionmovetotal(0, coin).
positionmovepost(0, coin).
% The agent's position status of GBX
positionmovetotal(0, gbx).
positionmovepost(0, gbx).
% The agent's position status of DASH
positionmovetotal(0, dash).
positionmovepost(0, dash).
% The agent's position status of SNAP
positionmovetotal(0, snap).
positionmovepost(0, snap).
% The agent's position status of APP
positionmovetotal(0, app).
positionmovepost(0, app).
% The agent's position status of IONQ
positionmovetotal(0, ionq).
positionmovepost(0, ionq).
% The agent's position status of TOST
positionmovetotal(0, tost).
positionmovepost(0, tost).
% The agent's position status of HIMS
positionmovetotal(0, hims).
positionmovepost(0, hims).
% The agent's position status of CMG
positionmovetotal(0, cmg).
positionmovepost(0, cmg).

%%% PERCENTAGE PREDICATES FOR TSLA %%%
percentagemoveday(489, tsla).
percentagemovepost(29, tsla).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR CART %%%
percentagemoveday(-12, cart).
percentagemovepost(-187, cart).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR COIN %%%
percentagemoveday(474, coin).
percentagemovepost(15, coin).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR GBX %%%
percentagemoveday(180, gbx).
percentagemovepost(-195, gbx).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR DASH %%%
percentagemoveday(692, dash).
percentagemovepost(23, dash).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR SNAP %%%
percentagemoveday(280, snap).
percentagemovepost(17, snap).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR APP %%%
percentagemoveday(493, app).
percentagemovepost(1, app).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR IONQ %%%
percentagemoveday(1014, ionq).
percentagemovepost(195, ionq).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR TOST %%%
percentagemoveday(-13, tost).
percentagemovepost(55, tost).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR HIMS %%%
percentagemoveday(593, hims).
percentagemovepost(102, hims).
%%%%%%%%%%%%%%%%%%%%%%
%%% PERCENTAGE PREDICATES FOR CMG %%%
percentagemoveday(186, cmg).
percentagemovepost(31, cmg).
%%%%%%%%%%%%%%%%%%%%%%

% Current profit
#const profit=40507.

#show monitor/1.
#show buy/2.
#show sell/2.
#show sell_all/2.
#show force_buy/2.

